<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Kai — AI Vibe Coding</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- SEO / OpenGraph -->
  <meta name="description" content="Kai — AI Vibe Coding. AI experiments, prototypes, and systems." />
  <meta property="og:title" content="Kai — AI Vibe Coding" />
  <meta property="og:description" content="AI experiments, prototypes, and vibe-coded projects." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://eekaishen.github.io/ai-vibecoding/" />

  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <main class="page">

    <header class="hero">
      <h1>Kai</h1>
      <p>AI Vibe Coding · Ideas → Prototypes → Experiments</p>
      <a class="contact-link" href="https://eekaishen.github.io/contact/" target="_blank" rel="noopener">
        Contact me
      </a>
    </header>

    <section class="grid" id="projectGrid"></section>

    <footer>© 2025 KAI · AI VIBE CODING</footer>
  </main>

  <!-- IMAGE MODAL -->
  <dialog id="imageModal" class="image-modal">
    <button class="nav prev" id="prevImg">‹</button>
    <img id="modalImage" />
    <button class="nav next" id="nextImg">›</button>
    <button class="close" id="closeImg">✕</button>
  </dialog>

  <!-- PROJECT MODAL -->
  <dialog id="projectModal" class="project-modal">
    <div id="projectContent"></div>
    <button class="close" id="closeProject">Close</button>
  </dialog>

  <script>
    /* ================= DOM ================= */
    const grid = document.getElementById('projectGrid');
    const imageModal = document.getElementById('imageModal');
    const modalImage = document.getElementById('modalImage');
    const projectModal = document.getElementById('projectModal');
    const projectContent = document.getElementById('projectContent');

    /* ================= GALLERY ================= */
    let galleryImages = [];
    let galleryIndex = 0;
    const projectImages = {};

    function openGallery(images, index) {
      galleryImages = images;
      galleryIndex = index;
      modalImage.src = galleryImages[galleryIndex];
      imageModal.showModal();
    }

    function nextImage() {
      galleryIndex = (galleryIndex + 1) % galleryImages.length;
      modalImage.src = galleryImages[galleryIndex];
    }

    function prevImage() {
      galleryIndex = (galleryIndex - 1 + galleryImages.length) % galleryImages.length;
      modalImage.src = galleryImages[galleryIndex];
    }

    document.getElementById('nextImg').onclick = nextImage;
    document.getElementById('prevImg').onclick = prevImage;
    document.getElementById('closeImg').onclick = () => imageModal.close();
    document.getElementById('closeProject').onclick = () => projectModal.close();

    /* ================= HELPERS ================= */
    async function imageExists(src) {
      try {
        const r = await fetch(src, { method: 'HEAD' });
        return r.ok;
      } catch {
        return false;
      }
    }

    /* ================= LOAD PROJECT ================= */
    async function loadProject(id) {
      const res = await fetch(`projects/${id}/content.txt`);
      if (!res.ok) return;

      const text = await res.text();
      const [meta, details] = text.split('details:');
      const lines = meta.split('\n');

      const title = lines.find(l => l.startsWith('title:'))?.replace('title:', '').trim() || '';
      const desc = lines.find(l => l.startsWith('description:'))?.replace('description:', '').trim() || '';
      const link = lines.find(l => l.startsWith('link:'))?.replace('link:', '').trim();
      const labels = lines.find(l => l.startsWith('labels:'))
        ?.replace('labels:', '').split(',').map(l => l.trim()) || [];

      /* Images */
      const imgs = [];
      for (let i = 1; i <= 5; i++) {
        const src = `projects/${id}/images/${i}.png`;
        if (await imageExists(src)) imgs.push(src);
      }
      projectImages[id] = imgs;

      const imagesHTML = imgs.map((src, i) =>
        `<img src="${src}" data-project="${id}" data-index="${i}" class="gallery-img">`
      ).join('');

      const card = document.createElement('article');
      card.className = 'card';

      card.innerHTML = `
    <div class="carousel">
      <div class="track">${imagesHTML}</div>
    </div>

    <h2>${title}</h2>
    <p class="desc">${desc}</p>

    ${details ? `<div class="more-link"><a href="#" data-more="${id}">More →</a></div>` : ''}

    <div class="labels">
      ${labels.map(l => `<span>${l}</span>`).join('')}
    </div>

    <div class="actions">
      ${link ? `<a class="visit-site" href="${link}" target="_blank">Website</a>` : ''}
      <button data-share="${id}" data-title="${title}">Share</button>
    </div>
  `;

      grid.appendChild(card);
    }

    /* ================= CLICK HANDLER ================= */
    document.addEventListener('click', e => {
      const img = e.target.closest('.gallery-img');
      if (img) {
        openGallery(
          projectImages[img.dataset.project],
          Number(img.dataset.index)
        );
        return;
      }

      const more = e.target.closest('[data-more]');
      if (more) {
        openProject(more.dataset.more);
        e.preventDefault();
        return;
      }

      const share = e.target.closest('[data-share]');
      if (share) {
        shareProject(share.dataset.share, share.dataset.title);
        return;
      }
    });

    /* ================= PROJECT MODAL ================= */
    function openProject(id) {
      fetch(`projects/${id}/content.txt`)
        .then(r => r.text())
        .then(t => {
          const body = t.split('details:')[1] || '';
          projectContent.innerHTML = body
            .split('\n\n')
            .map(p => `<p>${p.trim()}</p>`)
            .join('');
          projectModal.showModal();
        });
    }

    /* ================= SHARE ================= */
    function shareProject(id, title) {
      const url = location.origin + location.pathname + `#${id}`;
      if (navigator.share) {
        navigator.share({ title, text: title, url });
      } else {
        navigator.clipboard.writeText(url);
        alert('Link copied');
      }
    }

    /* ================= INIT ================= */
    fetch('projects/index.json')
      .then(r => r.json())
      .then(list => list.forEach(loadProject));
  </script>
</body>

</html>